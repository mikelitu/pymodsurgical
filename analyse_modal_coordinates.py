# Description: This script is used to analyse the modal coordinates of the system.
from complex import load_modal_coordinates, plot_modal_coordinates
from pathlib import Path

def main():
    modal_coordinates_dir = "spectrums/liver_stereo/modal_coordinates"
    files = list(Path(modal_coordinates_dir).rglob("*.npy"))
    for file in files:
        # Load the modal coordinates
        filename = file.stem
        splitted_px = filename.split("px")
        splitted_px = "".join(splitted_px)
        splitted_= splitted_px.split("_")[1:]
        
        displacement = []
        pixel = []

        change_2_pixel = False
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        for i in range(len(splitted_)):
            try:
                splitted_num = float(splitted_[i])
                if change_2_pixel:
                    pixel.append(splitted_num)
                else:
                    displacement.append(splitted_num)
            except ValueError:
                change_2_pixel = True
                continue
        
        modal_coordinates = load_modal_coordinates(file)
        # Plot the modal coordinates
        plot_modal_coordinates(modal_coordinates, displacement, pixel, save=True)

if __name__ == "__main__":
    main()